#For dose validation, creates RayStation plans with dose grids which are aligned. 
from connect import *

folder = r'\\path_to_your_local_folder\'
machine_name = 'your_machine_name'
import datetime

now = datetime.datetime.now()
file_name = folder + "\doses_" + now.strftime("%Y%m%d_%H%M%S") + ".txt"
patient = get_current("Patient")
case = patient.Cases[0]
beam_set = get_current('BeamSet')
dose_file  = open(file_name, "w")
dose_file.write(machine_name + "\n")

for plan in case.TreatmentPlans:
    beam_set = plan.BeamSets[0]
    beam_set.ComputeDose(DoseAlgorithm='CCDose', ForceRecompute = 1) 
    fraction_dose = beam_set.FractionDose
    names = []
    doses = []
    for idx, beam_dose in enumerate(fraction_dose.BeamDoses):
        planname = plan.Name + "," + beam_dose.ForBeam.Name 
        roiDose = beam_dose.GetDoseStatistic( RoiName = "LargeEvalVolume", DoseType = "Average")
        dose_file.write(planname + "," + str(roiDose) + ";\n" )

patient.Save()
dose_file.close()
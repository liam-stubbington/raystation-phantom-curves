<h1>Extracting Profiles and PDDs from RayStation 12A Phantoms</h1>
<p>This project contains a set of python modules that expedite the extraction of profiles and PDDs from a RayStation phantom.</p>
<p>The files are exported as a <em>bare bones</em> <em>.mcc</em> file which can opened in PTW programs for further analysis.</p>
<hr>
<h2>QuickStart Guide</h2>
<p>The script expects RayStation to be in a certain state.
All beams in the current BeamSet will have profiles and PDDs generated according to the following rules.</p>
<h3>Directory Structure</h3>
<p>Copy the <a href="./phantom_curves.py">phantom_curves.py</a> file into a project root directory. Also copy the <a href="./mcc/template/PDD.mcc">PDD.mcc</a> and <a href="./mcc/template/PROFILE.mcc">PROFILE.mcc</a> files.</p>
<p>Create a directory as follows:</p>
<ul>
<li>mcc
<ul>
<li>template
<ul>
<li>PDD.mcc</li>
<li>PROFILE.mcc</li>
</ul>
</li>
<li>raystation_data_out</li>
</ul>
</li>
<li>phantom_curves.py</li>
</ul>
<p>Exported profiles and PDDs will wind up in ./mcc/raystation_data_out/.</p>
<h3>POIs</h3>
<p>POIs define the start and end of each phantom curve.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Curve type</th>
<th style="text-align:left">POIs</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Crossplane Profile</td>
<td style="text-align:left">RIGHT -&gt; LEFT</td>
</tr>
<tr>
<td style="text-align:left">Inplane Profile</td>
<td style="text-align:left">GUN -&gt; TARGET</td>
</tr>
<tr>
<td style="text-align:left">AXIS</td>
<td style="text-align:left">PDD</td>
</tr>
</tbody>
</table>
<p>POIs will be extracted at all depths indicated with a POI named according to <em>d_Xcm</em>. PDDs will start at AXIS and continue to a depth of 50cm.</p>
<p>Capitalization in POI names is important. All must be defined for the script to work.</p>
<p><strong>No check of RayStation's state is done before executing the script.</strong> If these conditions are not met, the script will die silently.</p>
<p><img src="./screenshots/ex1_phantom.png" alt="Example RayStation set-up."></p>
<p>Example Patient:
RayTraining 40x40x40 Phantom, Case: LSt WaterTank Phantom, COMMISSIONING.</p>
<h2>BeamSet</h2>
<p>The current BeamSet should contain <strong>only 3D-CRT</strong> beams - at the time of writing, SMLC and DMLC beams are unsupported.</p>
<p>Final dose should be calculated.</p>
<p>The Beam Name and Description are used in output .mcc file - <strong>HINT</strong> - use descriptive names.</p>
<p><img src="./screenshots/ex2_beams.png" alt="Example Plans with Descriptive Beam Names"></p>
<h2>Limitations</h2>
<p><strong>This is a work in progress.</strong>
There are some known, <em>and many unknown</em> limitations:</p>
<ul>
<li>The FoR for the exported profiles is that of the current image set.
<ul>
<li>Profiles and PDDs may need to shifted to coincide with measured data.</li>
<li>You can do this, for multiple curves at once, in PTW DataAnalyse.</li>
</ul>
</li>
<li>A simple blank <em>template.mcc</em> file is modified &amp; saved. The resulting file will have the following limitations:
<ul>
<li>Collimator and gantry at zero</li>
<li>Measured in water</li>
<li>Energies come in as X.3 e.g 6FFF will be represented as 6.3. <strong>TO DO</strong></li>
<li>Field Type will be IRREGULAR</li>
<li>Reference field: 10x10, 5cm deep, ISOCENTER</li>
<li>SCD assumed 1000mm</li>
<li>Nominal dmax 20mm</li>
</ul>
</li>
</ul>
<h2>Validation</h2>
<p>The code output was validated by comparing a few script extracted profiles with the line dose tool in RayStation. More detail can be found in <a href="./validation/validating_phantom_curves_script.xlsx">this spreadsheet</a>.</p>
<p><img src="./screenshots/MLCFileld1.png" alt="Inplane Profile Script vs Manual for a complex MLC 3D-CRT beam">
<img src="./screenshots/PDD.png" alt="PDD script vs Manual for an example simple beam PDD"></p>
<h1>Developer Guide</h1>
<p>RayStation does most of the hard work!</p>
<p>There are two convenience classes that facilitate the automatic extraction of high quality phantom curves.</p>
<p>Usage then basically amounts to connecting the two objects together in a for loop though the current
BeamSet.</p>
<p><strong>Example Usage</strong></p>
<pre><code>from raystation_curves import RayCurves
from ptw_mcc import PTW_mcc 

# -- CONSTANTS -- 
beam_set = get_current(&quot;BeamSet&quot;)
PROJECT_ROOT = os.getcwd() 

for beam_dose in beam_set.FractionDose.BeamDoses:
    rc = RayCurves(
        beam_dose
    )

    for y, d in zip(rc.crossplane_profiles, rc.cax_depths):
        crossplane_profile_mcc = PTW_mcc(
            rc,
            curve_type = &quot;x profile&quot;,
            depth = d,
            energy = rc.energy,
            positions =rc.crossplane_positions,
            dose = y,
            f_root = PROJECT_ROOT
        )
        crossplane_profile_mcc.write_mcc()
</code></pre>
<h2>RayCurves</h2>
<p><a href="./rs_macros/raystation_curves.py">./rs_macros/raystation_curves.py</a></p>
<h2>PTW_mcc</h2>
<p><a href="./mcc/ptw_mcc.py">./mcc/ptw_mcc.py</a></p>
